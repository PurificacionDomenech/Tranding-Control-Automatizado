ANTES (No funciona)
textindex.html ‚Üí API Flask (no existe) ‚Üí Supabase
                  ‚Üì
           ‚ùå Error: API no disponible
DESPU√âS (Funcionar√°)
textindex.html ‚Üí Supabase JS Client ‚Üí Supabase
                  ‚Üì
           ‚úÖ Conexi√≥n directa

üîß CAMBIOS NECESARIOS EN TU C√ìDIGO
Voy a darte los bloques exactos de c√≥digo que debes cambiar en tu index.html actual.
PASO 1: Eliminar Variables de API (L√≠neas ~1288-1290)
‚ùå BUSCA Y ELIMINA:
JavaScript// --- API Configuration ---
// IMPORTANTE: Cambia esta URL por la URL de tu backend API en Replit
const API_BASE_URL = 'https://trading-control-api.tu-usuario.repl.co';
‚úÖ NO REEMPLACES con nada, simplemente elimina esas l√≠neas.

PASO 2: Eliminar Funciones de API (L√≠neas ~1292-1388)
‚ùå BUSCA Y ELIMINA TODO ESTE BLOQUE:
JavaScript// --- API Helper Functions ---
async function fetchOperacionesFromAPI(cuentaId) { ... }
async function saveOperacionToAPI(operacionData) { ... }
async function deleteOperacionFromAPI(operacionId) { ... }
function mapAPIOperationToFrontend(apiOp) { ... }
function mapFrontendOperationToAPI(frontendOp, cuentaId) { ... }
Son ~100 l√≠neas que debes eliminar completamente.
PASO 3: Reemplazar Carga de Operaciones (L√≠nea ~1502)
‚ùå BUSCA ESTO:
JavaScriptasync function setActiveAccount(id) {
    currentAccountId = id;
    localStorage.setItem(ACTIVE_ACCOUNT_KEY, currentAccountId);
    const settingsKey = getSettingsKey(currentAccountId);
    // ...
   
    // Cargar operaciones desde la API
    try {
        const apiOperaciones = await fetchOperacionesFromAPI(currentAccountId);
        operations = apiOperaciones.map(mapAPIOperationToFrontend);
        operations.sort(...);
        console.log('Operaciones cargadas desde API:', operations.length);
    } catch (error) {
        console.error('Error cargando operaciones desde API, usando localStorage como fallback:', error);
        const opsKey = getOperationsKey(currentAccountId);
        const storedOperations = localStorage.getItem(opsKey);
        operations = storedOperations ? JSON.parse(storedOperations) : [];
        operations.sort(...);
    }
    // ...
}
‚úÖ REEMPL√ÅZALO POR:
JavaScriptasync function setActiveAccount(id) {
    currentAccountId = id;
    localStorage.setItem(ACTIVE_ACCOUNT_KEY, currentAccountId);
    const settingsKey = getSettingsKey(currentAccountId);
    const storedSettings = localStorage.getItem(settingsKey);
    settings = storedSettings ? JSON.parse(storedSettings) : { initialBalance: 50000, consistencyPercentage: 40, trailingDrawdownAmount: 2500 };
    // ‚úÖ CARGAR DIRECTAMENTE DESDE SUPABASE
    try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) throw new Error('Usuario no autenticado');
        const { data: operaciones, error } = await supabase
            .from('operaciones')
            .select('*')
            .eq('cuenta_id', currentAccountId)
            .order('fecha_operacion', { ascending: true });
       
        if (error) throw error;
       
        operations = operaciones.map(op => ({
            id: op.id,
            date: op.fecha_operacion,
            type: op.tipo_operacion || null,
            activo: op.instrumento || 'N/A',
            estrategia: op.estrategia || 'N/A',
            contracts: op.contratos || 0,
            entryTime: op.hora_entrada || null,
            exitTime: op.hora_salida || null,
            duration: calculateDuration(op.hora_entrada, op.hora_salida),
            amount: parseFloat(op.resultado_pnl) || 0,
            notes: op.notas_psicologia || '',
            mood: '',
            newsRating: 0,
            media: op.captura_url || null,
            entryType: '',
            exitType: ''
        }));
       
        operations.sort((a, b) => new Date(a.date + 'T' + (a.entryTime || '00:00:00')) - new Date(b.date + 'T' + (b.entryTime || '00:00:00')));
        console.log('‚úÖ Operaciones cargadas desde Supabase:', operations.length);
       
    } catch (error) {
        console.error('‚ùå Error cargando desde Supabase:', error.message);
        // Fallback a localStorage
        const opsKey = getOperationsKey(currentAccountId);
        const storedOperations = localStorage.getItem(opsKey);
        operations = storedOperations ? JSON.parse(storedOperations) : [];
        operations.sort((a, b) => new Date(a.date + 'T' + (a.entryTime || '00:00:00')) - new Date(b.date + 'T' + (b.entryTime || '00:00:00')));
    }
    const journalsKey = getJournalsKey(currentAccountId);
    const storedJournals = localStorage.getItem(journalsKey);
    journals = storedJournals ? JSON.parse(storedJournals) : [];
    const goalsKey = getGoalsKey(currentAccountId);
    const storedGoals = localStorage.getItem(goalsKey);
    goals = storedGoals ? JSON.parse(storedGoals) : { weekly: 0, monthly: 0 };
    calculateHwmAndDrawdownFloor(true);
    populateAccountSelector();
    updateUI();
}

PASO 4: Reemplazar Guardado de Operaciones (L√≠nea ~1699)
‚ùå BUSCA ESTO (dentro del submit del formulario):
JavaScriptreadFileAsDataURL(mediaInput.files[0], async (mediaData) => {
    const operation = { ... };
    // Guardar en la API (sin enviar media base64, solo URL si existe)
    const apiData = mapFrontendOperationToAPI(operation, currentAccountId);
    const result = await saveOperacionToAPI(apiData);
    if (result.success) {
        // ...
    } else {
        // Fallback: guardar localmente si la API falla
        // ...
    }
});
‚úÖ REEMPL√ÅZALO POR:
JavaScriptreadFileAsDataURL(mediaInput.files[0], async (mediaData) => {
    const operation = {
        id: Date.now(),
        date,
        type,
        activo: activo || 'N/A',
        estrategia: estrategia || 'N/A',
        contracts: contracts,
        entryType: entryType || null,
        exitType: exitType || null,
        entryTime,
        exitTime,
        duration: calculateDuration(entryTime, exitTime),
        amount,
        notes,
        mood,
        newsRating,
        media: mediaData
    };
    // ‚úÖ GUARDAR DIRECTAMENTE EN SUPABASE
    try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) throw new Error('Usuario no autenticado');
        // Verificar duplicados ANTES de insertar
        const { data: existentes, error: errorCheck } = await supabase
            .from('operaciones')
            .select('id')
            .eq('cuenta_id', currentAccountId)
            .eq('fecha_operacion', operation.date)
            .eq('hora_entrada', operation.entryTime || '')
            .eq('instrumento', operation.activo);
        if (errorCheck) throw errorCheck;
        if (existentes && existentes.length > 0) {
            alert('‚ö†Ô∏è Esta operaci√≥n ya existe en la base de datos. No se guardar√° duplicada.');
            return;
        }
        // Insertar en Supabase
        const { data, error } = await supabase
            .from('operaciones')
            .insert([{
                cuenta_id: currentAccountId,
                instrumento: operation.activo,
                estrategia: operation.estrategia,
                fecha_operacion: operation.date,
                hora_entrada: operation.entryTime,
                hora_salida: operation.exitTime,
                contratos: operation.contracts,
                resultado_pnl: operation.amount,
                tipo_operacion: operation.type,
                notas_psicologia: operation.notes,
                captura_url: null
            }])
            .select();
       
        if (error) throw error;
       
        operation.id = data[0].id;
        operations.push(operation);
        operations.sort((a, b) => new Date(a.date + 'T' + (a.entryTime || '00:00:00')) - new Date(b.date + 'T' + (b.entryTime || '00:00:00')));
        calculateHwmAndDrawdownFloor();
        saveData(); // Backup en localStorage
       
        alert('‚úÖ Operaci√≥n guardada en Supabase correctamente.\n\nPuedes editarla desde el Historial para a√±adir m√°s detalles.');
    } catch (error) {
        console.error('‚ùå Error guardando en Supabase:', error.message);
        alert('‚ö†Ô∏è Error al guardar en Supabase: ' + error.message + '\n\nGuardando localmente como backup.');
       
        // Fallback: guardar solo en localStorage
        operations.push(operation);
        operations.sort((a, b) => new Date(a.date + 'T' + (a.entryTime || '00:00:00')) - new Date(b.date + 'T' + (b.entryTime || '00:00:00')));
        calculateHwmAndDrawdownFloor();
        saveData();
    }
    // Reset form
    document.getElementById('trading-form').reset();
    document.getElementById('date').value = new Date().toISOString().split('T')[0];
    document.getElementById('custom-activo-input').style.display = 'none';
    document.getElementById('custom-estrategia-input').style.display = 'none';
    document.getElementById('custom-entry-type-input').style.display = 'none';
    document.getElementById('custom-exit-type-input').style.display = 'none';
    setNewsRating(0);
    updateUI();
});

PASO 5: Reemplazar Eliminaci√≥n de Operaciones (L√≠nea ~1773)
‚ùå BUSCA ESTO:
JavaScriptasync function deleteOperation(id) {
    if (confirm('¬øEliminar esta operaci√≥n?')) {
        // Intentar eliminar de la API primero
        const result = await deleteOperacionFromAPI(id);
        if (result.success) {
            operations = operations.filter(op => op.id !== id);
            calculateHwmAndDrawdownFloor();
            saveData();
            updateUI();
            alert('Operaci√≥n eliminada de la base de datos.');
        } else {
            // Fallback...
        }
    }
}
‚úÖ REEMPL√ÅZALO POR:
JavaScriptasync function deleteOperation(id) {
    if (confirm('¬øEliminar esta operaci√≥n?')) {
        try {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) throw new Error('Usuario no autenticado');
            // ‚úÖ ELIMINAR DIRECTAMENTE DE SUPABASE
            const { error } = await supabase
                .from('operaciones')
                .delete()
                .eq('id', id)
                .eq('cuenta_id', currentAccountId);
           
            if (error) throw error;
           
            operations = operations.filter(op => op.id !== id);
            calculateHwmAndDrawdownFloor();
            saveData();
            updateUI();
            alert('‚úÖ Operaci√≥n eliminada de Supabase correctamente.');
           
        } catch (error) {
            console.error('‚ùå Error eliminando de Supabase:', error.message);
            alert('‚ö†Ô∏è Error al eliminar de Supabase: ' + error.message + '\n\nEliminando localmente.');
           
            operations = operations.filter(op => op.id !== id);
            calculateHwmAndDrawdownFloor();
            saveData();
            updateUI();
        }
    }
}

PASO 6: Reemplazar Actualizaci√≥n de Operaciones (L√≠nea ~1821)
‚ùå BUSCA ESTO en saveEditedOperation():
JavaScriptasync function saveEditedOperation() {
    // ... validaciones ...
    const updatedOperation = { ... };
    // Intentar actualizar en la API
    const apiData = mapFrontendOperationToAPI(updatedOperation, currentAccountId);
    apiData.id = id;
    try {
        const response = await fetch(`${API_BASE_URL}/operacion/${id}`, {
            method: 'PUT',
            // ...
        });
        // ...
    }
}
‚úÖ REEMPL√ÅZALO POR:
JavaScriptasync function saveEditedOperation() {
    const id = parseInt(document.getElementById('edit-operation-id').value);
    const opIndex = operations.findIndex(op => op.id === id);
    if (opIndex === -1) {
        alert('Operaci√≥n no encontrada.');
        return;
    }
    const date = document.getElementById('edit-date').value;
    const amount = parseAmount(document.getElementById('edit-amount').value);
    if (!date || isNaN(amount)) {
        alert('Fecha e Importe son obligatorios.');
        return;
    }
    const entryTime = document.getElementById('edit-entry-time').value || null;
    const exitTime = document.getElementById('edit-exit-time').value || null;
    const updatedOperation = {
        ...operations[opIndex],
        date: date,
        type: document.getElementById('edit-type').value || null,
        activo: document.getElementById('edit-activo').value || 'N/A',
        estrategia: document.getElementById('edit-estrategia').value || 'N/A',
        contracts: parseInt(document.getElementById('edit-contracts').value) || null,
        entryType: document.getElementById('edit-entry-type').value || null,
        exitType: document.getElementById('edit-exit-type').value || null,
        entryTime: entryTime,
        exitTime: exitTime,
        duration: calculateDuration(entryTime, exitTime),
        amount: amount,
        mood: document.getElementById('edit-mood').value || '',
        notes: document.getElementById('edit-notes').value || ''
    };
    // ‚úÖ ACTUALIZAR DIRECTAMENTE EN SUPABASE
    try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) throw new Error('Usuario no autenticado');
        const { error } = await supabase
            .from('operaciones')
            .update({
                instrumento: updatedOperation.activo,
                estrategia: updatedOperation.estrategia,
                fecha_operacion: updatedOperation.date,
                hora_entrada: updatedOperation.entryTime,
                hora_salida: updatedOperation.exitTime,
                contratos: updatedOperation.contracts,
                resultado_pnl: updatedOperation.amount,
                tipo_operacion: updatedOperation.type,
                notas_psicologia: updatedOperation.notes
            })
            .eq('id', id)
            .eq('cuenta_id', currentAccountId);
        if (error) throw error;
        operations[opIndex] = updatedOperation;
        operations.sort((a, b) => new Date(a.date + 'T' + (a.entryTime || '00:00:00')) - new Date(b.date + 'T' + (b.entryTime || '00:00:00')));
        calculateHwmAndDrawdownFloor();
        saveData();
        closeEditModal();
        updateUI();
        alert('‚úÖ Operaci√≥n actualizada en Supabase correctamente.');
    } catch (error) {
        console.error('‚ùå Error actualizando en Supabase:', error.message);
        alert('‚ö†Ô∏è Error al actualizar: ' + error.message + '\n\nActualizando localmente.');
       
        operations[opIndex] = updatedOperation;
        operations.sort((a, b) => new Date(a.date + 'T' + (a.entryTime || '00:00:00')) - new Date(b.date + 'T' + (b.entryTime || '00:00:00')));
        calculateHwmAndDrawdownFloor();
        saveData();
        closeEditModal();
        updateUI();
    }
}

PASO 7: Arreglar Modal de Importaci√≥n (L√≠nea ~3635)
‚ùå BUSCA ESTO en confirmImport():
JavaScriptfunction confirmImport() {
    if (importedOperations.length === 0) {
        alert('No hay operaciones para importar');
        return;
    }
   
    // ... c√≥digo que importa ...
   
    // Mensaje de confirmaci√≥n
    let message = `‚úì Se importaron ${imported} operaciones correctamente`;
   
    // ‚ùå FALTA CERRAR EL MODAL ANTES DEL ALERT
    alert(message);
}
‚úÖ REEMPL√ÅZALO POR:
JavaScriptfunction confirmImport() {
    if (importedOperations.length === 0) {
        alert('No hay operaciones para importar');
        return;
    }
   
    document.getElementById('btn-import-confirm').disabled = true;
   
    let imported = 0;
    let duplicates = 0;
   
    const opsToImport = [...importedOperations];
   
    opsToImport.forEach(op => {
        const isDuplicate = operations.some(existingOp =>
            existingOp.date === op.fecha &&
            existingOp.entryTime === op.hora_entrada &&
            existingOp.exitTime === op.hora_salida &&
            Math.abs(existingOp.amount - op.importe) < 0.01 &&
            existingOp.activo === op.activo
        );
       
        if (isDuplicate) {
            duplicates++;
            return;
        }
       
        const newOperation = {
            id: Date.now() + Math.random(),
            date: op.fecha,
            type: op.tipo.includes('Compra') ? 'bullish' : (op.tipo.includes('Venta') ? 'bearish' : ''),
            activo: op.activo,
            estrategia: op.estrategia || 'Importado NinjaTrader',
            contracts: op.contratos,
            entryTime: op.hora_entrada || '',
            exitTime: op.hora_salida || '',
            entryPrice: op.precio_entrada || 0,
            exitPrice: op.precio_salida || 0,
            amount: op.importe,
            entryType: 'Importado',
            exitType: 'Importado',
            newsRating: 0,
            mood: '',
            media: null,
            notes: ''
        };
       
        operations.push(newOperation);
        imported++;
    });
   
    importedOperations = [];
   
    operations.sort((a, b) => new Date(a.date + 'T' + (a.entryTime || '00:00:00')) - new Date(b.date + 'T' + (b.entryTime || '00:00:00')));
    calculateHwmAndDrawdownFloor();
    saveData();
    updateUI();
   
    let message = `‚úì Se importaron ${imported} operaciones correctamente`;
    if (duplicates > 0) {
        message += `\n\n${duplicates} operaciones duplicadas fueron omitidas`;
    }
   
    // ‚úÖ CERRAR MODAL ANTES DEL ALERT
    closeImportModal();
   
    // Peque√±o delay para que el usuario vea que el modal se cierra
    setTimeout(() => {
        alert(message);
    }, 300);
}

PASO 8: Arreglar Gr√°fico (L√≠nea ~3217)
‚ùå BUSCA en renderCapitalGrowthChart():
JavaScriptsortedOperations.forEach(op => {
    runningBalance += op.amount; // ‚ùå Puede ser string
    // ...
});
‚úÖ REEMPL√ÅZALO POR:
JavaScriptsortedOperations.forEach(op => {
    runningBalance += parseFloat(op.amount) || 0; // ‚úÖ Asegurar que sea n√∫mero
    // ...
});
Y tambi√©n aseg√∫rate de que al cargar datos:
JavaScriptoperations = operaciones.map(op => ({
    // ...
    amount: parseFloat(op.resultado_pnl) || 0, // ‚úÖ Convertir a n√∫mero
    // ...
}));

PASO 9: Implementar Resetear en Supabase (L√≠nea ~1486)
‚ùå BUSCA resetAllData():
JavaScriptfunction resetAllData() {
    if (confirm('¬øReiniciar TODAS las operaciones...')) {
        operations = [];
        journals = [];
        goals = { weekly: 0, monthly: 0 };
        // ...
        localStorage.removeItem(...);
        saveData();
        updateUI();
        alert('Datos reiniciados.');
    }
}
‚úÖ REEMPL√ÅZALO POR:
JavaScriptasync function resetAllData() {
    if (confirm('¬øReiniciar TODAS las operaciones, diarios y objetivos?\n\n‚ö†Ô∏è Esto borrar√° PERMANENTEMENTE todos los datos de Supabase.')) {
        try {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) throw new Error('Usuario no autenticado');
            // ‚úÖ BORRAR DE SUPABASE PRIMERO
            const { error } = await supabase
                .from('operaciones')
                .delete()
                .eq('cuenta_id', currentAccountId);
           
            if (error) throw error;
           
            alert('‚úÖ Datos eliminados de Supabase correctamente.');
           
        } catch (error) {
            console.error('‚ùå Error borrando de Supabase:', error.message);
            alert('‚ö†Ô∏è Error al borrar de Supabase: ' + error.message + '\n\nBorrando localmente.');
        }
       
        // Borrar tambi√©n de localStorage
        operations = [];
        journals = [];
        goals = { weekly: 0, monthly: 0 };
        highWaterMark = settings.initialBalance;
        drawdownFloor = settings.initialBalance - settings.trailingDrawdownAmount;
        localStorage.removeItem(getOperationsKey(currentAccountId));
        localStorage.removeItem(getJournalsKey(currentAccountId));
        localStorage.removeItem(getGoalsKey(currentAccountId));
        saveData();
        updateUI();
    }
}

üéâ RESUMEN DE LO QUE HEMOS LOGRADO
Con estos cambios:
‚úÖ Problema 1 resuelto: Verificaci√≥n de duplicados antes de .insert()
‚úÖ Problema 2 resuelto: Modal se cierra antes del alert
‚úÖ Problema 3 resuelto: parseFloat() en todos los amounts
‚úÖ Problema 4 resuelto: Resetear borra de Supabase
Y adem√°s:
‚úÖ Sin dependencia de backend Flask
‚úÖ Funciona en GitHub Pages
‚úÖ Conexi√≥n directa a Supabase
‚úÖ localStorage como backup autom√°tico